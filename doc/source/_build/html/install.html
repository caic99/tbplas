

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Install &mdash; TBPlaS 1.0.0-rc documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorials" href="tutorial/index.html" />
    <link rel="prev" title="About" href="about/index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> TBPlaS
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about/index.html">About</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Install</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#operating-system">Operating system</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#linux">Linux</a></li>
<li class="toctree-l4"><a class="reference internal" href="#windows">Windows</a></li>
<li class="toctree-l4"><a class="reference internal" href="#macos">MacOS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#compilers-and-math-libraries">Compilers and math libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#python">Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dependencies">Dependencies</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#general-rules">General rules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#workaround-for-undefined-symbol-error">Workaround for undefined symbol error</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#compilation">Compilation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installing-into-default-path">Installing into default path</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-into-user-specified-path">Installing into user-specified path</a></li>
<li class="toctree-l3"><a class="reference internal" href="#keeping-tbplas-in-the-source-code-directory">Keeping TBPlaS in the source code directory</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#testing">Testing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorial/index.html">Tutorial</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">TBPlaS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Install</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/install.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="install">
<h1>Install<a class="headerlink" href="#install" title="Permalink to this headline">¶</a></h1>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<div class="section" id="operating-system">
<h3>Operating system<a class="headerlink" href="#operating-system" title="Permalink to this headline">¶</a></h3>
<div class="section" id="linux">
<h4>Linux<a class="headerlink" href="#linux" title="Permalink to this headline">¶</a></h4>
<p>TBPlaS has been developed and tested on Linux. Ideally, it should work on most Linux distributions.
As examples, we have successfully installed and run TBPlaS on CentOS 7.7, openSUSE Leap 15.3 and
Ubuntu 20.04 LTS.</p>
</div>
<div class="section" id="windows">
<h4>Windows<a class="headerlink" href="#windows" title="Permalink to this headline">¶</a></h4>
<p>Due to compiler and library compatibility issues, native compilation of TBPlaS on Windows is particularly
difficult. So, if you wish to install TBPlaS on Windows, the best practice is to use virtual machines,
e.g., VirtualBox or VMWare. Windows Subsystem for Linux (WSL) is also an option. If you insist on native
compilation, and if you are an expert on computer, follow the guidelines in these links:</p>
<p><a class="reference external" href="https://stackoverflow.com/questions/52864588/how-to-install-cython-an-anaconda-64-bits-with-windows-10">https://stackoverflow.com/questions/52864588/how-to-install-cython-an-anaconda-64-bits-with-windows-10</a></p>
<p><a class="reference external" href="https://stackoverflow.com/questions/48826283/compile-fortran-module-with-f2py-and-python-3-6-on-windows-10">https://stackoverflow.com/questions/48826283/compile-fortran-module-with-f2py-and-python-3-6-on-windows-10</a></p>
</div>
<div class="section" id="macos">
<h4>MacOS<a class="headerlink" href="#macos" title="Permalink to this headline">¶</a></h4>
<p>Unfortunately, we have no experience of MacOS. You are encouraged to send us feedbacks on this operating system.</p>
</div>
</div>
<div class="section" id="compilers-and-math-libraries">
<h3>Compilers and math libraries<a class="headerlink" href="#compilers-and-math-libraries" title="Permalink to this headline">¶</a></h3>
<p>The performance-critical parts of TBPlaS are written in C and FORTRAN. Also, sparse matrices are utilized to
reduce memory cost. So, you need both C and FORTRAN compilers to compile TBPlaS, and link it to vendor-provided
math libraries for optimal performance. For Intel CPUs, it recommended to use Intel compilers and Math Kernel
Library (MKL), which are now bundled as oneAPI. If the Intel toolchain is not available, GNU Compiler Collection
(GCC) is a general choice. In that case, built-in sparse matrix library will be enabled automatically.</p>
<p>As examples, we have successfully compiled TBPlaS with Intel Compiler 19.0/2022.0 and GCC 6.3/7.5. Old versions
may still work, although not recommended.</p>
</div>
<div class="section" id="python">
<h3>Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h3>
<p>TBPlaS requires Python 3.6.x or newer. Python 2 is not supported.</p>
<p>In addition to the Python interpreter, development headers are also required. The actual package name of
development headers may vary among Linux distributions, e.g., python3-devel on rpm-based distributions such
as RedHat/CentOS/Fedora/openSUSE, and python3-dev on deb-based distributions like Debian/Ubuntu. Check the
manual of your distribution’s package manager (<code class="docutils literal notranslate"><span class="pre">yum</span></code> / <code class="docutils literal notranslate"><span class="pre">dnf</span></code> / <code class="docutils literal notranslate"><span class="pre">zypper</span></code> / <code class="docutils literal notranslate"><span class="pre">apt-get</span></code>) for guidelines
on searching and installing the package.</p>
<p>If you are a newbie to Linux, or if you do not have root privileges, or if you are working with a computer
without Internet access, try the <a class="reference external" href="https://www.anaconda.com/products/individual">Anaconda</a> offline installer,
which bundles the development headers as well as other dependencies.</p>
</div>
<div class="section" id="dependencies">
<h3>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt>TBPlaS requires the following Python packages as mandatory dependencies:</dt><dd><ul class="simple">
<li><p>NumPy &gt;= 1.19.2</p></li>
<li><p>SciPy &gt;= 1.5.2</p></li>
<li><p>Matplotlib &gt;= 3.3.2</p></li>
<li><p>Cython &gt;= 0.29.21</p></li>
<li><p>Setupools &gt;=50.3.1</p></li>
</ul>
</dd>
<dt>And the following packages as optional:</dt><dd><ul class="simple">
<li><p>ASE &gt;=3.22.1 (for LAMMPS interface)</p></li>
<li><p>MPI4PY &gt;= 3.0.3 (for hybrid MPI+OpenMP parallelization)</p></li>
</ul>
</dd>
</dl>
<p>Old versions may still work, but not recommended.</p>
<p>Most of the dependencies can be installed via the pip command, e.g., <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">numpy</span></code>.
If you do not have root privileges, add <code class="docutils literal notranslate"><span class="pre">--user</span></code> option to install into you home directory, e.g.,
<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--user</span> <span class="pre">numpy</span></code>. If your computer has no Internet access, try the Anaconda
offline installer, as aforementioned in previous section.</p>
<p>The installation of MPI4PY is more complex. You need a working MPI implementation. Since OpenMPI
suffers from a limitation on the number of OpenMP threads when there are too few MPI processes,
MPICH3 or newer is preferred. See the following links for installing MPICH/OpenMPI:</p>
<p><a class="reference external" href="https://www.mpich.org/documentation/guides/">https://www.mpich.org/documentation/guides/</a></p>
<p><a class="reference external" href="https://www.open-mpi.org//faq/?category=building">https://www.open-mpi.org//faq/?category=building</a></p>
<p>and the following link for installing MPI4PY</p>
<p><a class="reference external" href="https://mpi4py.readthedocs.io/en/stable/install.html">https://mpi4py.readthedocs.io/en/stable/install.html</a></p>
</div>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="general-rules">
<h3>General rules<a class="headerlink" href="#general-rules" title="Permalink to this headline">¶</a></h3>
<p>The configuration of compilation is stored in <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code> in the top directory of TBPlaS source code.
Some examples are placed under <code class="docutils literal notranslate"><span class="pre">config</span></code> subdirectory. A common <code class="docutils literal notranslate"><span class="pre">setyp.cfg</span></code> consists of the following
sections:</p>
<blockquote>
<div><ul class="simple">
<li><p>config_cc: C compiler configuration</p></li>
<li><p>config_fc: FORTRAN compiler configuration</p></li>
<li><p>build_ext: external library configuration</p></li>
</ul>
</div></blockquote>
<p>You should adjust these settings according to your computer’s hardware and software environment.
Here is an example using Intel compilers and built-in sparse matrix library:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="k">[config_cc]</span>
<span class="na">compiler</span> <span class="o">=</span> <span class="s">intelem</span>

<span class="k">[config_fc]</span>
<span class="na">fcompiler</span> <span class="o">=</span> <span class="s">intelem</span>
<span class="na">arch</span> <span class="o">=</span> <span class="s">-xHost</span>
<span class="na">opt</span> <span class="o">=</span> <span class="s">-qopenmp -O3 -ipo -heap-arrays 32</span>
<span class="na">f90flags</span> <span class="o">=</span> <span class="s">-fpp</span>
</pre></div>
</div>
<p>And here is the example using Intel compilers and MKL:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="k">[config_cc]</span>
<span class="na">compiler</span> <span class="o">=</span> <span class="s">intelem</span>

<span class="k">[config_fc]</span>
<span class="na">fcompiler</span> <span class="o">=</span> <span class="s">intelem</span>
<span class="na">arch</span> <span class="o">=</span> <span class="s">-xHost</span>
<span class="na">opt</span> <span class="o">=</span> <span class="s">-qopenmp -O3 -ipo -heap-arrays 32</span>
<span class="na">f90flags</span> <span class="o">=</span> <span class="s">-fpp -DMKL</span>

<span class="k">[build_ext]</span>
<span class="na">include_dirs</span> <span class="o">=</span> <span class="s">/software/intel/parallelstudio/2019/compilers_and_libraries/linux/mkl/include</span>
<span class="na">library_dirs</span> <span class="o">=</span> <span class="s">/software/intel/parallelstudio/2019/compilers_and_libraries/linux/mkl/lib/intel64</span>
<span class="na">libraries</span> <span class="o">=</span> <span class="s">mkl_rt iomp5 pthread m dl</span>
</pre></div>
</div>
<p>Another example using GCC and built-in sparse matrix library:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="k">[config_cc]</span>
<span class="na">compiler</span> <span class="o">=</span> <span class="s">unix</span>

<span class="k">[config_fc]</span>
<span class="na">fcompiler</span> <span class="o">=</span> <span class="s">gfortran</span>
<span class="na">arch</span> <span class="o">=</span> <span class="s">-march=native</span>
<span class="na">opt</span> <span class="o">=</span> <span class="s">-fopenmp -O3 -flto -mtune=native</span>
<span class="na">f90flags</span> <span class="o">=</span> <span class="s">-fno-second-underscore -cpp</span>
</pre></div>
</div>
</div>
<div class="section" id="workaround-for-undefined-symbol-error">
<h3>Workaround for undefined symbol error<a class="headerlink" href="#workaround-for-undefined-symbol-error" title="Permalink to this headline">¶</a></h3>
<p>You may run into errors complaining about <code class="docutils literal notranslate"><span class="pre">undefined</span> <span class="pre">symbol:</span> <span class="pre">GOMP_parallel</span></code> when testing your build and
installation. In that case, find the location of libgomp.so, for instance, <code class="docutils literal notranslate"><span class="pre">/usr/lib64</span></code>. Add it to
<code class="docutils literal notranslate"><span class="pre">build_ext</span></code> section of <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code> and re-compile TBPlaS. This issue will be solved.</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="k">[build_ext]</span>
<span class="na">library_dirs</span> <span class="o">=</span> <span class="s">/usr/lib64</span>
<span class="na">libraries</span> <span class="o">=</span> <span class="s">gomp</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="compilation">
<h2>Compilation<a class="headerlink" href="#compilation" title="Permalink to this headline">¶</a></h2>
<p>Once <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code> has been properly configured, you can build TBPlaS with this command: <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">build</span></code>.
If everything goes well, a new <code class="docutils literal notranslate"><span class="pre">build</span></code> directory will be created. The C and FORTRAN extensions can be found under
<code class="docutils literal notranslate"><span class="pre">lib.linux-x86_64-3.x</span></code> sub-directory, with x being the minor version of Python interpreter. If any error occurs,
check <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code> carefully as described in previous sections.</p>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>TBPlaS can be installed to the default path, user-specified path, or kept in the source code directory. Installin
into the default path is the simplest way, since it does not involve setting up environment variables. However,
it is difficult to keep multiple versions or to update TBPlaS in that approach. Installing into user-specified
path solves this problem, yet it requires appending a <strong>long</strong> path to environment variables. Keeping the source
code simplifies the environment setting process, and offers the access to source code if necessary. So, personally,
we suggest keeping the source code directory.</p>
<div class="section" id="installing-into-default-path">
<h3>Installing into default path<a class="headerlink" href="#installing-into-default-path" title="Permalink to this headline">¶</a></h3>
<p>Installing TBPlaS into the default path is as easy as <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">install</span></code>. After installation you can invoke
Python and try <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">tbplas</span></code>. If no error occurs, then your installation is successful. If there are errors on
undefined symbol, check the workaround in previous section.</p>
</div>
<div class="section" id="installing-into-user-specified-path">
<h3>Installing into user-specified path<a class="headerlink" href="#installing-into-user-specified-path" title="Permalink to this headline">¶</a></h3>
<p>Installing into user-specified path is achieved by adding <code class="docutils literal notranslate"><span class="pre">--prefix</span></code> option to the <code class="docutils literal notranslate"><span class="pre">install</span></code> command. For example,
<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">install</span> <span class="pre">--prefix=/home/foo/bar</span></code> will install TBPlaS into the directory of <code class="docutils literal notranslate"><span class="pre">/home/foo/bar</span></code>.
You must add the follow directory to the <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> environment variable:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PYTHONPATH</span><span class="o">=</span>/home/foo/bar/lib/python3.6/site-packages:<span class="nv">$PYTHONPATH</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PYTHONPATH</span><span class="o">=</span>/home/foo/bar/lib/python3.8/site-packages/tbplas-0.9.8-py3.8-linux-x86_64.egg:<span class="nv">$PYTHONPATH</span>
</pre></div>
</div>
<p>depending on yourpython environment. Anyway, the tbplas sub-directory must reside under the directory you add to
<code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code>. You can also add this command into your <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code> to make it permanently effective, i.e.,
you will not need to type it every time you log in or open a new terminal.</p>
</div>
<div class="section" id="keeping-tbplas-in-the-source-code-directory">
<h3>Keeping TBPlaS in the source code directory<a class="headerlink" href="#keeping-tbplas-in-the-source-code-directory" title="Permalink to this headline">¶</a></h3>
<p>To keep TBPlaS in the source code directory you need to manually copy C/FORTRAN extensions from build directory to
proper destinations:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cp build/lib.linux-x86_64-3.8/tbplas/builder/core.cpython-38-x86_64-linux-gnu.so tbplas/builder
cp build/lib.linux-x86_64-3.8/tbplas/fortran/f2py.cpython-38-x86_64-linux-gnu.so tbplas/fortran
</pre></div>
</div>
<p>Note the actual locations and names of the extensions depends on the version of your Python interpreter. Then add
source code directory to PYTHONPATH. For instance,</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PYTHONPATH</span><span class="o">=</span>/home/foo/bar/tbplas_src:<span class="nv">$PYTHONPATH</span>
</pre></div>
</div>
<p>with <code class="docutils literal notranslate"><span class="pre">tbplas_src</span></code> being the source code directory, in which <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> and other files reside. Also, do not forget
to add this command to your <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code> to make it permanently effective.</p>
</div>
</div>
<div class="section" id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h2>
<p>There are some testing scripts under tests directory of source code. You can test your compilation and installation
by invoking these scripts, e.g., <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">test_core.py</span></code>. Some output will be printed to the screen and some figures
will be saved to disk. If everything goes well, a notice will be raised saying all the tests have been passed by the
end of each script.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="tutorial/index.html" class="btn btn-neutral float-right" title="Tutorials" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="about/index.html" class="btn btn-neutral float-left" title="About" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017-2022, Edo van Veen, Guus Slotman, Kaixiang Huang, Yunhai Li, Xueheng Kuang &amp; Shengjun Yuan.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>